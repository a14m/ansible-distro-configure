---
- name: "Add Go to shell profile"
  ansible.builtin.blockinfile:
    path: "{{ ansible_env.HOME }}/.bashrc"
    state: "present"
    prepend_newline: true
    append_newline: true
    marker: "# ==== {mark} ANSIBLE GO CONFIG"
    block: |
      if command -v go 1>/dev/null 2>&1; then
          export PATH="$HOME/go/bin:$PATH"
      fi

- name: "Install and configure Go latest"
  when: go_versions | length == 0
  block:
    - name: "Install latest Go"
      community.general.homebrew:
        name: "go"
        state: "present"

    - name: "Set latest Go as global version"
      ansible.builtin.command:
        cmd: "brew link --force go"
      environment:
        PATH: "/home/linuxbrew/.linuxbrew/bin:{{ ansible_env.PATH }}"
      changed_when: true

- name: "Install and configure Go versions"
  when: go_versions | length > 0
  block:
    - name: "Install specific Go versions"
      community.general.homebrew:
        name: "go@{{ item }}"
        state: "present"
      with_items: "{{ go_versions }}"

    - name: "Set specific Go version as global"
      ansible.builtin.command:
        cmd: "brew link --force go@{{ go_global_version }}"
      environment:
        PATH: "/home/linuxbrew/.linuxbrew/bin:{{ ansible_env.PATH }}"
      when: go_global_version != ""
      changed_when: true
