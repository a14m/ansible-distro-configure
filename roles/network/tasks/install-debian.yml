---
- name: "Ensure network_packages are installed"
  become: true
  ansible.builtin.apt:
    pkg: "{{ network_packages }}"
    state: "present"

- name: "Collect facts about installed packages"
  ansible.builtin.package_facts:
    manager: "apt"

- name: "Ensure avahi/dhcpcd packages are removed"
  become: true
  ansible.builtin.apt:
    pkg:
      - "avahi-daemon"
      - "avahi-utils"
      - "dhcpcd"
    state: "absent"
    autoremove: true
    purge: true
  when: >
    'avahi-daemon' in ansible_facts.packages or
    'avahi-utils' in ansible_facts.packages or
    'dhcpcd' in ansible_facts.packages
